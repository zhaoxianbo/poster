(function(t){function e(e){for(var o,i,s=e[0],l=e[1],c=e[2],m=0,p=[];m<s.length;m++)i=s[m],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&p.push(n[i][0]),n[i]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);u&&u(e);while(p.length)p.shift()();return a.push.apply(a,c||[]),r()}function r(){for(var t,e=0;e<a.length;e++){for(var r=a[e],o=!0,s=1;s<r.length;s++){var l=r[s];0!==n[l]&&(o=!1)}o&&(a.splice(e--,1),t=i(i.s=r[0]))}return t}var o={},n={app:0},a=[];function i(e){if(o[e])return o[e].exports;var r=o[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=o,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(r,o,function(e){return t[e]}.bind(null,o));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=l;a.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"4d41":function(t,e,r){t.exports=r.p+"img/avatar.5ed64cc8.png"},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d");var o=r("2b0e"),n=(r("1951"),r("450d"),r("eedf")),a=r.n(n),i=(r("bd49"),r("18ff")),s=r.n(i),l=(r("960d"),r("defb")),c=r.n(l),u=(r("cb70"),r("b370")),m=r.n(u),p=(r("fe07"),r("6ac5")),d=r.n(p),f=(r("b5d8"),r("f494")),v=r.n(f),h=(r("f225"),r("89a9")),g=r.n(h),b=(r("b5c2"),r("20cf")),x=r.n(b),w=(r("a586"),r("7464")),F=r.n(w),y=(r("9d4c"),r("e450")),k=r.n(y),_=(r("10cb"),r("f3ad")),C=r.n(_),R=(r("acb6"),r("c673")),z=r.n(R),$=(r("e3ea"),r("7bc3")),I=r.n($),j=(r("0c67"),r("299c")),O=r.n(j),U=(r("e612"),r("dd87")),q=r.n(U),L=(r("075a"),r("72aa")),P=r.n(L),S=(r("eca7"),r("3787")),T=r.n(S),M=(r("425f"),r("4105")),E=r.n(M),B=(r("6dca"),r("2cf9")),D=r.n(B);o["default"].use(D.a),o["default"].use(E.a),o["default"].use(T.a),o["default"].use(P.a),o["default"].use(q.a),o["default"].use(O.a),o["default"].use(I.a),o["default"].use(z.a),o["default"].use(C.a),o["default"].use(k.a),o["default"].use(F.a),o["default"].use(x.a),o["default"].use(g.a),o["default"].use(v.a),o["default"].use(d.a),o["default"].use(m.a),o["default"].use(c.a),o["default"].use(s.a),o["default"].use(a.a);r("6e0c"),r("a342");var Y=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"poster-container"},[r("el-tabs",{staticClass:"poster-layer",model:{value:t.tabLeft,callback:function(e){t.tabLeft=e},expression:"tabLeft"}},[r("el-tab-pane",{attrs:{label:"图层",name:"layer"}},[r("draggable",{attrs:{handle:".el-icon-rank"},model:{value:t.posterForm.items,callback:function(e){t.$set(t.posterForm,"items",e)},expression:"posterForm.items"}},[r("transition-group",t._l(t.posterForm.items,(function(e,o){return r("div",{key:e.uuid,staticClass:"poster-layer-item",class:{active:e.active},on:{click:function(r){return t.activeItem(e)}}},[r("div",{staticClass:"layer-name"},[r("i",{class:["iconfont","icon-"+e.t]}),r("span",[t._v(t._s(e.name))])]),r("div",{staticClass:"layer-btns"},[r("i",{staticClass:"el-icon-rank"}),r("i",{staticClass:"el-icon-delete-solid",on:{click:function(e){return e.stopPropagation(),t.delItem(o)}}})])])})),0)],1),r("el-empty",{directives:[{name:"show",rawName:"v-show",value:!t.posterForm.items.length,expression:"!posterForm.items.length"}],attrs:{description:"暂无图层","image-size":100}})],1)],1),r("div",{staticClass:"poster-main"},[r("div",{staticClass:"poster-tool"},[t._l(t.toolList,(function(e,o){return r("div",{key:o,staticClass:"tool-item",on:{click:function(r){return t.addItem(e)}}},[r("el-tooltip",{attrs:{effect:"dark",content:e.text,placement:"bottom"}},[r("i",{class:["iconfont",e.icon]})])],1)})),r("div",{staticClass:"tool-item",on:{click:t.preview}},[r("el-tooltip",{attrs:{effect:"dark",content:"预览",placement:"bottom"}},[r("i",{staticClass:"iconfont icon-preview"})])],1),r("div",{staticClass:"tool-item",on:{click:t.download}},[r("el-tooltip",{attrs:{effect:"dark",content:"下载",placement:"bottom"}},[r("i",{staticClass:"iconfont icon-download"})])],1),r("div",{staticClass:"tool-item"},[r("i",{staticClass:"el-icon-minus",on:{click:function(e){return t.scaleChange(-.05)}}}),r("p",{staticClass:"scale"},[t._v(t._s((100*t.posterForm.scale).toFixed(0))+"%")]),r("i",{staticClass:"el-icon-plus",on:{click:function(e){return t.scaleChange(.05)}}})])],2),r("div",{ref:"main",staticClass:"main"},[r("div",{staticClass:"canvas",style:t.canvasStyle,attrs:{id:"canvas"}},[t.posterForm.bgUrl?r("img",{staticClass:"bg-img",attrs:{src:t.posterForm.bgUrl,crossorigin:"anonymous"}}):t._e(),t._l([].concat(t.posterForm.items).reverse(),(function(e){return r("vdr",{key:e.uuid,staticClass:"layer-item",attrs:{parent:"","parent-width":t.posterForm.width*t.posterForm.scale,"parent-height":t.posterForm.height*t.posterForm.scale,w:e.w*t.posterForm.scale,h:e.h*t.posterForm.scale,x:e.x*t.posterForm.scale,y:e.y*t.posterForm.scale,"min-width":10,"min-height":10},on:{activated:function(r){return t.activeItem(e)},resizing:function(r,o,n,a){return t.resize(e,r,o,n,a)},dragging:function(r,o){return t.drag(e,r,o)}}},[["text"].includes(e.t)?r("p",{staticClass:"canvas-text",style:t.textStyle(e)},[t._v(" "+t._s(e.v)+" ")]):t._e(),"qrcode"===e.t?r("div",{ref:e.uuid,refInFor:!0,staticClass:"canvas-qrcode"}):t._e(),["image","logo"].includes(e.t)?[r("img",{staticClass:"canvas-image",attrs:{src:e.v,crossorigin:"anonymous"}})]:t._e(),"avatar"===e.t?r("img",{staticClass:"canvas-avatar",attrs:{src:e.v,crossorigin:"anonymous"}}):t._e()],2)}))],2)])]),r("el-tabs",{staticClass:"poster-setting",model:{value:t.tabRight,callback:function(e){t.tabRight=e},expression:"tabRight"}},[r("el-tab-pane",{attrs:{label:"属性设置",name:"attr"}},[r("el-form",{attrs:{model:t.attrForm,size:"mini","label-width":"80px"}},[r("el-divider",{attrs:{"content-position":"left"}},[t._v("位置大小")]),r("el-form-item",{attrs:{label:"x"}},[r("el-input-number",{attrs:{"controls-position":"right",size:"mini"},model:{value:t.attrForm.x,callback:function(e){t.$set(t.attrForm,"x",e)},expression:"attrForm.x"}})],1),r("el-form-item",{attrs:{label:"y"}},[r("el-input-number",{attrs:{"controls-position":"right",size:"mini"},model:{value:t.attrForm.y,callback:function(e){t.$set(t.attrForm,"y",e)},expression:"attrForm.y"}})],1),r("el-form-item",{attrs:{label:"宽度"}},[r("el-input-number",{attrs:{"controls-position":"right",size:"mini"},model:{value:t.attrForm.w,callback:function(e){t.$set(t.attrForm,"w",e)},expression:"attrForm.w"}})],1),r("el-form-item",{attrs:{label:"高度"}},[r("el-input-number",{attrs:{"controls-position":"right",size:"mini"},model:{value:t.attrForm.h,callback:function(e){t.$set(t.attrForm,"h",e)},expression:"attrForm.h"}})],1),["text","qrcode"].includes(t.attrForm.t)?[r("el-divider",{attrs:{"content-position":"left"}},[t._v("颜色")]),r("el-form-item",{attrs:{label:"颜色"}},[r("el-color-picker",{on:{change:t.updateqrCode},model:{value:t.attrForm.c,callback:function(e){t.$set(t.attrForm,"c",e)},expression:"attrForm.c"}})],1)]:t._e(),["text"].includes(t.attrForm.t)?[r("el-divider",{attrs:{"content-position":"left"}},[t._v("字体")]),r("el-form-item",{attrs:{label:"大小"}},[r("el-slider",{attrs:{min:12},model:{value:t.attrForm.s,callback:function(e){t.$set(t.attrForm,"s",e)},expression:"attrForm.s"}})],1)]:t._e(),["image","avatar"].includes(t.attrForm.t)?[r("el-divider",{attrs:{"content-position":"left"}},[t._v("图片")]),r("el-form-item",{attrs:{label:"图片"}},[r("el-upload",{staticClass:"upload-btn",attrs:{action:"/",accept:"image/*","show-file-list":!1,"http-request":t.uploadImage}},[r("el-button",{attrs:{size:"mini",type:"primary"}},[t._v("上传")])],1),r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){t.attrForm.v=""}}},[t._v("删除")])],1)]:t._e(),r("el-divider",{attrs:{"content-position":"left"}},[t._v("参数")]),r("el-form-item",{attrs:{label:"名称"}},[r("el-input",{model:{value:t.attrForm.name,callback:function(e){t.$set(t.attrForm,"name",e)},expression:"attrForm.name"}})],1),r("el-form-item",{attrs:{label:"静态参数"}},[r("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4}},on:{input:t.updateqrCode},model:{value:t.attrForm.v,callback:function(e){t.$set(t.attrForm,"v",e)},expression:"attrForm.v"}})],1)],2)],1),r("el-tab-pane",{attrs:{label:"海报设置",name:"poster"}},[r("el-form",{attrs:{model:t.posterForm,size:"mini","label-width":"60px"}},[r("el-divider",{attrs:{"content-position":"left"}},[t._v("基本信息")]),r("el-form-item",{attrs:{label:"名称"}},[r("el-input",{model:{value:t.posterForm.name,callback:function(e){t.$set(t.posterForm,"name",e)},expression:"posterForm.name"}})],1),r("el-form-item",{attrs:{label:"格式"}},[r("el-radio-group",{model:{value:t.posterForm.type,callback:function(e){t.$set(t.posterForm,"type",e)},expression:"posterForm.type"}},[r("el-radio",{attrs:{label:"png"}}),r("el-radio",{attrs:{label:"jpg"}})],1)],1),"jpg"===t.posterForm.type?r("el-form-item",{attrs:{label:"质量"}},[r("el-slider",{attrs:{min:30},model:{value:t.posterForm.quality,callback:function(e){t.$set(t.posterForm,"quality",e)},expression:"posterForm.quality"}})],1):t._e(),r("el-divider",{attrs:{"content-position":"left"}},[t._v("海报尺寸")]),r("el-form-item",[r("el-dropdown",{on:{command:t.sizeChange}},[r("el-button",{attrs:{type:"primary",size:"mini"}},[t._v(" 常用尺寸"),r("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.sizeList,(function(e,o){return r("el-dropdown-item",{key:o,attrs:{command:e}},[t._v(t._s(e.w)+"×"+t._s(e.h))])})),1)],1)],1),r("el-form-item",{attrs:{label:"宽度"}},[r("el-input-number",{attrs:{"controls-position":"right",size:"mini",min:100},model:{value:t.posterForm.width,callback:function(e){t.$set(t.posterForm,"width",e)},expression:"posterForm.width"}})],1),r("el-form-item",{attrs:{label:"高度"}},[r("el-input-number",{attrs:{"controls-position":"right",size:"mini",min:100},model:{value:t.posterForm.height,callback:function(e){t.$set(t.posterForm,"height",e)},expression:"posterForm.height"}})],1),r("el-divider",{attrs:{"content-position":"left"}},[t._v("背景")]),r("el-form-item",{attrs:{label:"背景色"}},[r("el-color-picker",{model:{value:t.posterForm.bgc,callback:function(e){t.$set(t.posterForm,"bgc",e)},expression:"posterForm.bgc"}})],1),r("el-form-item",{attrs:{label:"背景图"}},[r("el-upload",{staticClass:"upload-btn",attrs:{action:"/",accept:"image/*","show-file-list":!1,"http-request":t.uploadBgUrl}},[r("el-button",{attrs:{size:"mini",type:"primary"}},[t._v("上传")])],1),r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){t.posterForm.bgUrl=""}}},[t._v("删除背景图")])],1),r("el-form-item",{attrs:{label:"背景图地址"}},[r("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4}},model:{value:t.posterForm.bgUrl,callback:function(e){t.$set(t.posterForm,"bgUrl",e)},expression:"posterForm.bgUrl"}})],1)],1)],1)],1),r("el-image",{ref:"imgPreview",staticClass:"img-preview",attrs:{src:t.imgPreviewUrl,"preview-src-list":[t.imgPreviewUrl]}})],1)},N=[],Q=r("5530"),H=r("1da1"),J=(r("96cf"),r("99af"),r("4de4"),r("d3b7"),r("d81d"),r("caad"),r("2532"),r("b0c0"),r("a434"),r("b680"),r("c0e9")),X=r.n(J),A=r("d044"),G=r.n(A),K=r("b76a"),V=r.n(K),W=r("611b"),Z=r.n(W);r("c78c"),r("ac1f"),r("5319"),r("25f0");function tt(){return"xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0,r="x"==t?e:3&e|8;return r.toString(16)}))}function et(t){var e={text:{c:"#000000",h:60,name:"文本",s:16,t:"text",uuid:tt(),v:"多行文本测试1多行文本测试2多行文本测试3多行文本测试4",w:200,x:0,y:0},qrcode:{c:"#000000",h:80,name:"二维码",s:15,t:"qrcode",uuid:tt(),v:location.href,w:80,x:0,y:0},avatar:{c:"#000000",h:40,name:"头像",s:15,t:"avatar",uuid:tt(),v:r("4d41"),w:40,x:0,y:0},image:{c:"#000000",h:100,name:"图片",s:15,t:"image",uuid:tt(),v:r("bf05"),w:100,x:0,y:0}};return e[t]}var rt={components:{draggable:V.a,vdr:Z.a},computed:{canvasStyle:function(){var t=this.posterForm,e=t.width,r=t.height,o=t.scale,n=t.bgc,a=this.position,i=a.left,s=a.top;return{width:"".concat(e*o,"px"),height:"".concat(r*o,"px"),"background-color":n||"#fff",transform:"translate(".concat(i,"px, ").concat(s,"px)")}},textStyle:function(){var t=this;return function(e){var r=t.posterForm.scale,o=e.c,n=e.s;return{"font-size":"".concat(n*r,"px"),color:o||"inherit"}}}},data:function(){return{tabLeft:"layer",position:{left:0,top:0},toolList:[{icon:"icon-text",text:"文本",type:"text"},{icon:"icon-qrcode",text:"二维码",type:"qrcode"},{icon:"icon-avatar",text:"头像",type:"avatar"},{icon:"icon-image",text:"图片",type:"image"}],tabRight:"poster",attrForm:{},posterForm:{name:"未命名",type:"jpg",quality:80,width:640,height:1008,scale:1,bgc:null,bgUrl:null,items:[]},sizeList:[{w:640,h:1008},{w:720,h:1280}],imgPreviewUrl:""}},created:function(){},mounted:function(){var t=this,e=this.$refs.main;e.onmousedown=function(e){var r=e.clientX,o=e.clientY,n=e.path,a=n.map((function(t){return t.className})).filter((function(t){return t}));if(!a.some((function(t){return t.includes("layer-item")}))){var i=t.position,s=i.left,l=i.top;document.onmousemove=function(e){t.position={left:e.clientX-r+s,top:e.clientY-o+l}}}document.onmouseup=function(){document.onmousemove=document.onmouseup=null}},e.onmousewheel=function(e){var r=e.deltaY;t.position.top-=r}},methods:{addItem:function(t){var e=this;return Object(H["a"])(regeneratorRuntime.mark((function r(){var o,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:o=et(t.type),n=Object(Q["a"])(Object(Q["a"])({},o),{},{active:!0}),e.posterForm.items.map((function(t){return t.active=!1})),e.posterForm.items.unshift(n),e.attrForm=n,e.tabRight="attr","qrcode"===t.type&&e.getQrcode(n);case 7:case"end":return r.stop()}}),r)})))()},preview:function(){var t=this;return Object(H["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getImgUrl();case 2:r=e.sent,t.imgPreviewUrl=r,setTimeout((function(){t.$refs.imgPreview.$el.getElementsByClassName("el-image__preview")[0].click()}),10);case 5:case"end":return e.stop()}}),e)})))()},download:function(){var t=this;return Object(H["a"])(regeneratorRuntime.mark((function e(){var r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getImgUrl();case 2:r=e.sent,o=document.createElement("a"),o.href=r,o.download="".concat(t.posterForm.name,".").concat(t.posterForm.type),document.body.appendChild(o),o.click(),document.body.removeChild(o);case 9:case"end":return e.stop()}}),e)})))()},delItem:function(t){this.posterForm.items.splice(t,1),this.attrForm={},this.tabRight="poster"},activeItem:function(t){this.tabRight="attr",this.posterForm.items.map((function(t){return t.active=!1})),t.active=!0,this.attrForm=t},resize:function(t,e,r,o,n){var a=this.posterForm.scale;t.w=this.numInt(o/a),t.h=this.numInt(n/a),t.y=this.numInt(e/a),t.x=this.numInt(r/a)},drag:function(t,e,r){var o=this.posterForm.scale;t.y=this.numInt(r/o),t.x=this.numInt(e/o)},numInt:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return parseInt(t.toFixed(e))},getQrcode:function(t){var e=this;this.$nextTick((function(){new G.a(e.$refs[t.uuid][0],{text:t.v,width:t.w,height:t.h,colorDark:t.c,colorLight:"#ffffff",correctLevel:G.a.CorrectLevel.H})}))},updateqrCode:function(){var t=this.attrForm,e=t.t,r=t.uuid,o=t.c,n=t.v,a=t.w,i=t.h;"qrcode"===e&&(this.$refs[r][0].innerHTML="",this.getQrcode({uuid:r,c:o,v:n,w:a,h:i}))},sizeChange:function(t){this.posterForm.width=t.w,this.posterForm.height=t.h},scaleChange:function(t){var e=this.posterForm.scale;(t>0&&e<2||t<0&&e>.25)&&(e=+(e+t).toFixed(2)),this.posterForm.scale=e},upload:function(t){return new Promise((function(e){var r=new FileReader;r.readAsDataURL(t),r.onload=function(){return e(r.result)},r.onerror=function(){return e("")}}))},uploadImage:function(t){var e=this;return Object(H["a"])(regeneratorRuntime.mark((function r(){var o,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=t.file,r.next=3,e.upload(o);case 3:n=r.sent,n&&(e.attrForm.v=n);case 5:case"end":return r.stop()}}),r)})))()},uploadBgUrl:function(t){var e=this;return Object(H["a"])(regeneratorRuntime.mark((function r(){var o,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=t.file,r.next=3,e.upload(o);case 3:n=r.sent,n&&(e.posterForm.bgUrl=n);case 5:case"end":return r.stop()}}),r)})))()},getImgUrl:function(){var t=this;return new Promise((function(e){console.log("开始获取海报图片URL");var r=document.getElementById("canvas"),o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;document.body.style.position="fixed",document.body.style.top="-".concat(o,"px"),console.log(r),X()(r,{allowTaint:!0,useCORS:!0}).then((function(r){console.log("转化成功"),console.log(r);var o=t.posterForm,n=o.type,a=o.quality,i="png"===n?r.toDataURL("image/png"):r.toDataURL("image/jpeg",a/100);console.log(i),e(i)})).catch((function(){console.log("转化失败"),e(null)})),document.body.style.position="",document.body.style.top="",window.scrollTo(0,o)}))}}},ot=rt,nt=r("2877"),at=Object(nt["a"])(ot,Y,N,!1,null,null,null),it=at.exports;o["default"].config.productionTip=!1,new o["default"]({render:function(t){return t(it)}}).$mount("#app")},"6e0c":function(t,e,r){},a342:function(t,e,r){},bf05:function(t,e,r){t.exports=r.p+"img/image.ac106d7f.png"}});
//# sourceMappingURL=app.3f187c4c.js.map